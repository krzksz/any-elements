{"version":3,"file":"kompot.js","sources":["../src/config.js","../src/Component.js","../src/registry.js"],"sourcesContent":["export const attributeName = \"data-kompot\";\nexport const propertyName = \"kompot\";\n","import * as config from \"./config\";\n\nexport default class Component {\n  constructor(element) {\n    this.element = element;\n    element[config.propertyName] = this;\n  }\n  destructor() {}\n}\n","import * as config from \"./config\";\n\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n\nlet registeredComponents = [];\nlet observer = null;\n\nconst init = (element, component) => {\n  element.setAttribute(config.attributeName, component.name);\n  element[config.propertyName] = new component.constructor(element);\n};\n\nconst initAll = parentNode => {\n  if (parentNode.nodeType !== Node.ELEMENT_NODE) {\n    return;\n  }\n\n  registeredComponents.forEach(component => {\n    if (\n      parentNode.matches(`${component.selector}:not([${config.attributeName}])`)\n    ) {\n      init(parentNode, component);\n    }\n\n    const matchedElements = parentNode.querySelectorAll(\n      `${component.selector}:not([${config.attributeName}])`\n    );\n    for (let i = 0; i < matchedElements.length; i++) {\n      init(matchedElements[i], component);\n    }\n  });\n};\n\nconst register = (selector, name, constructor) => {\n  registeredComponents.push({ selector, name, constructor });\n};\n\nconst unregister = (selector, name) => {\n  registeredComponents = registeredComponents.filter(component => {\n    return component.selector !== selector && component.name !== name;\n  });\n};\n\nconst destruct = componentElement => {\n  componentElement.removeAttribute(config.attributeName);\n  const componentToDestruct = componentElement[config.propertyName];\n  componentToDestruct.destructor();\n};\n\nconst destructAll = parentNode => {\n  if (parentNode.nodeType !== Node.ELEMENT_NODE) {\n    return;\n  }\n\n  if (parentNode.hasAttribute(config.attributeName)) {\n    destruct(parentNode);\n  }\n\n  const matchedElements = parentNode.querySelectorAll(\n    `[${config.attributeName}]`\n  );\n  const matchedElementsLength = matchedElements.length;\n  for (let i = 0; i < matchedElementsLength; i++) {\n    destruct(matchedElements[i]);\n  }\n};\n\nconst mutationCallback = mutationsList => {\n  mutationsList.forEach(mutation => {\n    const removedNodes = mutation.removedNodes;\n    const removedNodesLength = removedNodes.length;\n    for (let i = 0; i < removedNodesLength; i++) {\n      destructAll(removedNodes[i]);\n    }\n\n    const addedNodes = mutation.addedNodes;\n    const addedNodesLength = addedNodes.length;\n    for (let i = 0; i < addedNodesLength; i++) {\n      initAll(addedNodes[i]);\n    }\n  });\n};\n\nconst attach = (rootNode = document.body) => {\n  detach();\n  observer = new MutationObserver(mutationCallback).observe(rootNode, {\n    childList: true,\n    subtree: true,\n  });\n  initAll(rootNode);\n};\n\nconst detach = () => {\n  if (observer) {\n    observer.disconnect();\n    observer = null;\n  }\n};\n\nexport { register, unregister, attach, detach };\n"],"names":["const","Component","element","this","destructor","Element","prototype","matches","msMatchesSelector","let","registeredComponents","observer","init","component","setAttribute","name","constructor","initAll","parentNode","nodeType","Node","ELEMENT_NODE","forEach","matchedElements","querySelectorAll","i","length","destruct","componentElement","removeAttribute","destructAll","hasAttribute","matchedElementsLength","mutationCallback","mutationsList","mutation","removedNodes","removedNodesLength","addedNodes","addedNodesLength","detach","disconnect","selector","push","filter","rootNode","document","body","MutationObserver","observe","childList","subtree"],"mappings":"AAAOA,ICEcC,EACnB,SAAYC,GACVC,KAAKD,QAAUA,WACgBC,kBAEjCC,wBCLGC,QAAQC,UAAUC,UACrBF,QAAQC,UAAUC,QAAUF,QAAQC,UAAUE,mBAGhDC,IAAIC,KACAC,EAAW,KAETC,WAAQV,EAASW,GACrBX,EAAQY,aFVmB,cEUgBD,EAAUE,MACrDb,SAA+B,IAAIW,EAAUG,YAAYd,IAGrDe,WAAUC,GACVA,EAAWC,WAAaC,KAAKC,cAIjCX,EAAqBY,iBAAQT,GAEzBK,EAAWX,QAAWM,mCAEtBD,EAAKM,EAAYL,GAMnB,IAHAb,IAAMuB,EAAkBL,EAAWM,iBAC9BX,kCAEIY,EAAI,EAAGA,EAAIF,EAAgBG,OAAQD,IAC1Cb,EAAKW,EAAgBE,GAAIZ,MAezBc,WAAWC,GACfA,EAAiBC,gBF9CU,eE+CCD,SACRxB,cAGhB0B,WAAcZ,GAClB,GAAIA,EAAWC,WAAaC,KAAKC,aAAjC,CAIIH,EAAWa,aFxDY,gBEyDzBJ,EAAST,GAOX,IAJAlB,IAAMuB,EAAkBL,EAAWM,kCAG7BQ,EAAwBT,EAAgBG,OACrCD,EAAI,EAAGA,EAAIO,EAAuBP,IACzCE,EAASJ,EAAgBE,MAIvBQ,WAAmBC,GACvBA,EAAcZ,iBAAQa,GAGpB,IAFAnC,IAAMoC,EAAeD,EAASC,aACxBC,EAAqBD,EAAaV,OAC/BD,EAAI,EAAGA,EAAIY,EAAoBZ,IACtCK,EAAYM,EAAaX,IAK3B,IAFAzB,IAAMsC,EAAaH,EAASG,WACtBC,EAAmBD,EAAWZ,OAC3BD,EAAI,EAAGA,EAAIc,EAAkBd,IACpCR,EAAQqB,EAAWb,OAcnBe,aACA7B,IACFA,EAAS8B,aACT9B,EAAW,qDA9DG+B,EAAU3B,EAAMC,GAChCN,EAAqBiC,eAAOD,OAAU3B,cAAMC,iCAG1B0B,EAAU3B,GAC5BL,EAAuBA,EAAqBkC,gBAAO/B,UAC1CA,EAAU6B,WAAaA,GAAY7B,EAAUE,OAASA,6BA4CjD8B,kBAAWC,SAASC,MAClCP,IACA7B,EAAW,IAAIqC,iBAAiBf,GAAkBgB,QAAQJ,GACxDK,WAAW,EACXC,SAAS,IAEXlC,EAAQ4B"}