{"version":3,"file":"kompot.mjs","sources":["../src/kompot.js"],"sourcesContent":["export class Component {\r\n\r\n    constructor(element) {\r\n        this.element = element;\r\n        element[componentProperty] = this;\r\n    }\r\n    destructor() {}\r\n}\r\n\r\nconst rootNode = document.body;\r\nconst componentAttribute = 'data-ms-component';\r\nconst componentProperty = 'msComponent';\r\n\r\nconst registeredComponents = [];\r\n\r\nconst initAll = () => {\r\n    registeredComponents.forEach(component => {\r\n        const matchedElements = rootNode.querySelectorAll(\r\n            `${component.selector}:not([${componentAttribute}])`\r\n        );\r\n        for (let i = 0; i < matchedElements.length; i++) {\r\n            const matchedElement = matchedElements[i];\r\n            if (matchedElement[componentProperty]) {\r\n                continue;\r\n            }\r\n            matchedElement.setAttribute(\r\n                componentAttribute,\r\n                component.constructor.name\r\n            );\r\n            matchedElement[componentProperty] = new component.constructor(\r\n                matchedElement\r\n            );\r\n        }\r\n    });\r\n};\r\n\r\nexport const register = (selector, constructor) => {\r\n    registeredComponents.push({ selector, constructor });\r\n};\r\n\r\nconst destruct = (componentElement) => {\r\n    componentElement.removeAttribute(componentAttribute);\r\n    const componentToDestruct = componentElement[componentProperty];\r\n    componentToDestruct.destructor();\r\n};\r\n\r\nconst destructAll = (parentNode) => {\r\n    if (parentNode.nodeType !== Node.ELEMENT_NODE) {\r\n        return;\r\n    }\r\n\r\n    if (parentNode.hasAttribute(componentAttribute)) {\r\n        destruct(parentNode);\r\n    }\r\n\r\n    const matchedElements = parentNode.querySelectorAll(\r\n        `[${componentAttribute}]`\r\n    );\r\n    const matchedElementsLength = matchedElements.length;\r\n    for (let i = 0; i < matchedElementsLength; i++) {\r\n        destruct(matchedElements[i]);\r\n    }\r\n};\r\n\r\nconst mutationCallback = mutationsList => {\r\n    mutationsList.forEach(mutation => {\r\n        const removedNodes = mutation.removedNodes;\r\n        const removedNodesLength = removedNodes.length;\r\n        for (let i = 0; i < removedNodesLength; i++) {\r\n            destructAll(removedNodes[i]);\r\n        }\r\n\r\n        if (mutation.addedNodes.length) {\r\n            initAll();\r\n        }\r\n    });\r\n};\r\n\r\nexport const attach = () => {\r\n    new MutationObserver(mutationCallback).observe(rootNode, {\r\n        childList: true,\r\n        subtree: true,\r\n    });\r\n    initAll();\r\n};\r\n"],"names":["Component","element","this","componentProperty","destructor","const","rootNode","document","body","registeredComponents","initAll","forEach","component","matchedElements","querySelectorAll","i","length","matchedElement","setAttribute","constructor","name","register","selector","push","destruct","componentElement","removeAttribute","destructAll","parentNode","nodeType","Node","ELEMENT_NODE","hasAttribute","matchedElementsLength","mutationCallback","mutationsList","mutation","removedNodes","removedNodesLength","addedNodes","attach","MutationObserver","observe","childList","subtree"],"mappings":"IAAaA,EAET,SAAYC,GACRC,KAAKD,QAAUA,EACfA,EAAQE,GAAqBD,kBAEjCE,wBAGJC,IAAMC,EAAWC,SAASC,KAEpBL,EAAoB,cAEpBM,KAEAC,aACFD,EAAqBE,iBAAQC,GAIzB,IAHAP,IAAMQ,EAAkBP,EAASQ,iBAC1BF,wCAEEG,EAAI,EAAGA,EAAIF,EAAgBG,OAAQD,IAAK,CAC7CV,IAAMY,EAAiBJ,EAAgBE,GACnCE,EAAed,KAGnBc,EAAeC,aAfA,oBAiBXN,EAAUO,YAAYC,MAE1BH,EAAed,GAAqB,IAAIS,EAAUO,YAC9CF,QAMHI,WAAYC,EAAUH,GAC/BV,EAAqBc,eAAOD,cAAUH,KAGpCK,WAAYC,GACdA,EAAiBC,gBA/BM,qBAgCKD,EAAiBtB,GACzBC,cAGlBuB,WAAeC,GACjB,GAAIA,EAAWC,WAAaC,KAAKC,aAAjC,CAIIH,EAAWI,aAzCQ,sBA0CnBR,EAASI,GAOb,IAJAvB,IAAMQ,EAAkBe,EAAWd,wCAG7BmB,EAAwBpB,EAAgBG,OACrCD,EAAI,EAAGA,EAAIkB,EAAuBlB,IACvCS,EAASX,EAAgBE,MAI3BmB,WAAmBC,GACrBA,EAAcxB,iBAAQyB,GAGlB,IAFA/B,IAAMgC,EAAeD,EAASC,aACxBC,EAAqBD,EAAarB,OAC/BD,EAAI,EAAGA,EAAIuB,EAAoBvB,IACpCY,EAAYU,EAAatB,IAGzBqB,EAASG,WAAWvB,QACpBN,OAKC8B,aACT,IAAIC,iBAAiBP,GAAkBQ,QAAQpC,GAC3CqC,WAAW,EACXC,SAAS,IAEblC"}